---
title: "SpinTheBottle"
themecolor: "#681D1D"
showMeta: false
---
<style type="text/css">.app-view,.bottle,.tab-view>section.active{display:block!important}.button-group,.list-view>li,.tab-view>header{display:-webkit-flex;display:flex;-webkit-flex-flow:row nowrap;-moz-flex-flow:row nowrap;-ms-flex-flow:row nowrap;-o-flex-flow:row nowrap;flex-flow:row nowrap;overflow:auto}.bottle,.list-view>li{overflow:hidden}.list-view{padding:0;margin:0;list-style:none}.bottle{width:100%;max-width:400px}.bottle img{display:block;-webkit-transform:scale(.9);-ms-transform:scale(.9);-o-transform:scale(.9);transform:scale(.9)}.tab-view>section,body .hidden{display:none}</style>
<script type="text/javascript">var UI=function(){"use strict";function e(){this.List=function(){var e,t=this;arguments.length>0&&(e=document.getElementById(arguments[0])),e||(e=document.createElement("ul")),this.host=e,e.UITarget=this,e.classList.add("list-view"),e.addEventListener("click",function(e){e.target.classList.contains("remove")&&t.items.indexOf(e.target.parentElement)>=0&&(t.host.removeChild(e.target.parentElement),"function"==typeof t.onremove&&t.onremove({id:e.target.parentElement.getAttribute("data-id")}),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}),e.addEventListener("change",function(e){e.target.classList.contains("value")&&t.items.indexOf(e.target.parentElement)>=0&&"function"==typeof t.onchange&&t.onchange({id:e.target.parentElement.getAttribute("data-id"),value:e.target.value})})},Object.defineProperties(this.List.prototype,{items:{get:function(){var e,t=this.host&&this.host.children,a=[],n=0,r=t.length;for(n;e=t[n],n<r;n++)"li"==e.tagName.toLowerCase()&&a.push(e);return a},enumerable:!0,configurable:!1},values:{get:function(){var e,t,a=this.items,n=[],r=0,i=a.length;for(r;e=a[r],r<i;r++){var t=e.getElementsByTagName("input")[0].value;t&&(e.getAttribute("data-id")?n.push({id:e.getAttribute("data-id"),value:t}):n.push(t))}return n},set:function(e){var t,a=this.items,n=0,r=a.length;for(n;t=a[n],n<r;n++)this.host.removeChild(t);for(n=0,r=e.length,n;t=e[n],n<r;n++)t&&("string"==typeof t?this.add(t):this.add(t.id,t.value))},enumerable:!0,configurable:!1},add:{value:function(e){var t;arguments.length>1&&(t=e,e=arguments[1]);var a=document.createElement("li"),n=document.createElement("input"),r=document.createElement("button");return t&&a.setAttribute("data-id",t),n.type="text",n.placeholder=I18n("Insert text here"),e&&(n.value=e),n.classList.add("value"),a.appendChild(n),r.innerHTML=I18n("-"),r.classList.add("remove"),a.appendChild(r),"function"==typeof this.onadd&&this.onadd({id:t,value:e}),this.host.appendChild(a),n.focus(),t?{id:t,value:e}:e},writable:!1,enumerable:!0,configurable:!1}}),this.Tab=function(){var e,t=this;arguments.length>0&&(e=document.getElementById(arguments[0])),e||(e=document.createElement("div")),this.host=e,e.UITarget=this,e.classList.add("tab-view"),e.addEventListener("click",function(e){t.headers.indexOf(e.target)>=0&&(t.active={id:e.target.getAttribute("data-for")},e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}),null==this.header&&(null==e.firstChild?e.appendChild(document.createElement("header")):e.insertBefore(document.createElement("header"),e.firstChild)),this.active=this.active},Object.defineProperties(this.Tab.prototype,{header:{get:function(){var e,t=this.host&&this.host.children,a=0,n=t.length;for(a;e=t[a],a<n;a++)if("header"==e.tagName.toLowerCase())return e;return null},enumerable:!0,configurable:!1},headers:{get:function(){var e,t=this.header&&this.header.children,a=[],n=0,r=t.length;for(n;e=t[n],n<r;n++)"button"==e.tagName.toLowerCase()&&a.push(e);return a},enumerable:!0,configurable:!1},sections:{get:function(){var e,t=this.host&&this.host.children,a=[],n=0,r=t.length;for(n;e=t[n],n<r;n++)"section"==e.tagName.toLowerCase()&&a.push(e);return a},enumerable:!0,configurable:!1},add:{value:function(e,t){var a=this.get(e);if(null!=a.header||null!=a.section)throw"Already exists: "+e;var n=document.createElement("button");n.setAttribute("data-for",e),n.innerHTML=t,this.header.appendChild(n);var r=document.createElement("section");return r.setAttribute("data-id",e),this.host.appendChild(r),this.active=this.active,{id:e,title:t,header:n,section:r}},writable:!1,enumerable:!0,configurable:!1},get:{value:function(e){var t,a,n=this.headers,r=this.sections,i={id:e,title:null,header:null,section:null},o=0,s=n.length;for(o;t=n[o],o<s;o++)if(t.getAttribute("data-for")==e){i.header=t,i.title=t.innerHTML;break}for(o=0,s=r.length,o;a=r[o],o<s;o++)if(a.getAttribute("data-id")==e){i.section=a;break}return i},writable:!1,enumerable:!0,configurable:!1},remove:{value:function(e){var t=this.get(e);if(null==t.header||null==t.section)throw"Does not exist: "+e;return this.header.removeChild(t.header),this.host.removeChild(t.section),this.active=this.active,t},writable:!1,enumerable:!0,configurable:!1},active:{get:function(){var e,t=this.headers,a=0,n=t.length;for(a;e=t[a],a<n;a++)if(e.classList.contains("active"))return this.get(e.getAttribute("data-for"));if(t.length>0){e=t[0];var r=this.get(e.getAttribute("data-for"));return r.header.classList.add("active"),r.section.classList.add("active"),r}return{id:null,title:null,header:null,section:null}},set:function(e){var t=this.get(e&&e.id);if(null==t.id)return t;if(null==t.header||null==t.section)throw"Not found: "+t.id;var a=this.active;return a.id==t.id?t:(a.header.classList.remove("active"),a.section.classList.remove("active"),t.header.classList.add("active"),t.section.classList.add("active"),t)},enumerable:!0,configurable:!1}})}return new e}(),Game=function(){"use strict";function e(){var e;arguments.length>0&&(e=document.getElementById(arguments[0])),e||(e=document.createElement("div")),this.host=e,e.classList.add("app-view")}function t(e,t,a,n){var r=e.add(t,a),i=new UI.List;n&&(i.values=n),r.section.appendChild(i.host);var o=document.createElement("div");o.classList.add("button-group");var s=document.createElement("button");s.innerHTML=I18n("+ add"),s.addEventListener("click",function(e){i.add(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),o.appendChild(s);var l=document.createElement("button");l.innerHTML=I18n("&gt; export"),l.addEventListener("click",function(e){prompt(I18n("Copy data from this export-prompt"),JSON.stringify(i.values)),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),o.appendChild(l);var d=document.createElement("button");d.innerHTML=I18n("&lt; import"),d.addEventListener("click",function(e){var t=prompt(I18n("Paste data into this import-prompt"),"[]");t&&(t=JSON.parse(t),confirm(I18n("Do you wish to clear the list before import?"))?i.values=t:i.values=i.values.concat(t)),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),o.appendChild(d),r.section.appendChild(o)}function a(e){return Math.floor(Math.round(Math.random()*(e-1)))}return Object.defineProperties(e.prototype,{setup:{value:function(){for(var e=this,a=!0;this.host.firstChild;)this.host.removeChild(this.host.firstChild);var n=document.createElement("h2");n.innerHTML=I18n("Setup"),this.host.appendChild(n);var r=new UI.Tab,i=r.add("settings",I18n("Settings")),o=new UI.List;o.onadd=function(e){a||t(r,e.id,e.value)},o.onchange=function(e){r.get(e.id).header.innerHTML=e.value},o.onremove=function(e){r.remove(e.id)},i.section.appendChild(o.host);var s=document.createElement("div");s.classList.add("button-group");var l=document.createElement("button");l.addEventListener("click",function(e){o.add("tab"+Date.now(),I18n("New Category")),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),l.innerHTML=I18n("+ add"),s.appendChild(l);var d=document.createElement("button");d.addEventListener("click",function(t){var a=[],n=!1;o.values.forEach(function(e){var t=r.get(e.id),i=t.section.getElementsByTagName("ul")[0].UITarget,o=i.values;o.length>0&&(a.push({id:e.id,name:e.value,values:o}),n=!0)});var i=r.get("players").section.getElementsByTagName("ul")[0].UITarget.values;localStorage.setItem("spinTheBottlePlayers",JSON.stringify(i)),localStorage.setItem("spinTheBottleData",JSON.stringify(a)),e.start(i,a),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}),d.innerHTML=I18n("Save and start"),s.appendChild(d);var c=document.createElement("button");c.addEventListener("click",function(e){var t=prompt("Paste data into this import-prompt",'{"players":[],"data":[]}');t&&confirm("Confirm to import data and reload page")&&(t=JSON.parse(t),localStorage.setItem("spinTheBottlePlayers",JSON.stringify(t.players)),localStorage.setItem("spinTheBottleData",JSON.stringify(t.data)),location.reload()),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),c.innerHTML=I18n("&lt; import"),s.appendChild(c);var u=document.createElement("button");u.addEventListener("click",function(e){var t=[],a=!1;o.values.forEach(function(e){var n=r.get(e.id),i=n.section.getElementsByTagName("ul")[0].UITarget,o=i.values;o.length>0&&(t.push({id:e.id,name:e.value,values:o}),a=!0)});var n=r.get("players").section.getElementsByTagName("ul")[0].UITarget.values;localStorage.setItem("spinTheBottlePlayers",JSON.stringify(n)),localStorage.setItem("spinTheBottleData",JSON.stringify(t)),prompt("Copy data from this export-prompt",JSON.stringify({players:n,data:t})),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),u.innerHTML=I18n("&gt; export"),s.appendChild(u),i.section.appendChild(s),this.host.appendChild(r.host);var h=JSON.parse(localStorage.getItem("spinTheBottlePlayers")||"[]"),p=JSON.parse(localStorage.getItem("spinTheBottleData")||"[]");t(r,"players",I18n("Players"),h),p.forEach(function(e){o.add(e.id,e.name),t(r,e.id,e.name,e.values)}),a=!1},writable:!1,enumerable:!0,configurable:!1},start:{value:function(e,t){for(var n=this,r=null,i=null;this.host.firstChild;)this.host.removeChild(this.host.firstChild);var o=new UI.Tab;o.header.classList.add("hidden"),this.host.appendChild(o.host);var s=o.add("bottle",I18n("Bottle")),l=o.add("categories",I18n("Categories")),d=o.add("task",I18n("Task")),c=JSON.stringify(t);this.players=e.map(function(e){return{name:e,data:JSON.parse(c)}}),0==this.players.length&&(this.players=null);var u=document.createElement("h2");u.innerHTML=I18n("Player"),s.section.appendChild(u);var h=document.createElement("div");h.classList.add("bottle");var p=document.createElement("img");p.src=location.pathname.replace(/\/$/,"")+"/bottle.svg",p.rotate=0,h.appendChild(p),s.section.appendChild(h);var m=document.createElement("button");m.classList.add("hidden"),m.innerHTML=I18n("Next"),m.addEventListener("click",function(t){var a={name:"Player",data:JSON.parse(c)};if(n.players){var r=e[Math.floor(p.rotate/360*e.length)],s=0,d=n.players.length;for(s;(a=n.players[s],s<d)&&a.name!=r;s++);i=a}o.active=l;for(var u,h,m,f=a.data;g.firstChild;)g.removeChild(g.firstChild);v.innerHTML=a.name;var s=0,d=f.length;for(s;u=f[s],s<d;s++)h=document.createElement("li"),m=document.createElement("button"),m.innerHTML=u.name,m.category=u,m.player=a,h.appendChild(m),g.appendChild(h);t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}),s.section.appendChild(m);var v=document.createElement("h2");v.innerHTML=I18n("Player"),l.section.appendChild(v);var g=document.createElement("ul");g.classList.add("list-view"),g.addEventListener("click",function(e){var t,i=e.target.category,s=e.target.player,l=a(i.values.length);i[l]==r&&i.length>1&&l--,t=i.values.splice(l,1)[0],r=t,0==i.values.length&&(s.data.splice(s.data.indexOf(i),1),n.players&&0==s.data.length&&(n.players.splice(n.players.indexOf(s),1),0==n.players.length&&I.classList.add("hidden"))),o.active=d,I.focus(),b.innerHTML=s.name,y.innerHTML=t,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),l.section.appendChild(g);var f=document.createElement("button");f.innerHTML=I18n("SpinTheBottle"),f.addEventListener("click",function(e){I.click(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),l.section.appendChild(f);var b=document.createElement("h2");b.innerHTML=I18n("Player"),d.section.appendChild(b);var y=document.createElement("p");d.section.appendChild(y);var L=document.createElement("div");L.classList.add("button-group");var I=document.createElement("button");I.innerHTML=I18n("SpinTheBottle"),I.addEventListener("click",function(t){o.active=s,m.classList.add("hidden");var r=n.players,l=e,d=I18n("Player");null==r&&(r=[{name:d}],l=[d]),new Promise(function(e){var t=a(r.length);r[t]==i&&(t++,t>=r.length&&(t=0));var n,o=l.indexOf(r[t].name),s=360*o/r.length+a(360/r.length),d=a(2)+2,c=2*d;n=1==a(2)?setInterval(function(){p.rotate+=c,p.rotate>=360&&(p.rotate-=360,d--,c/=2),p.style.webkitTransform="scale(0.9) rotate("+p.rotate+"deg)",p.style.msTransform="scale(0.9) rotate("+p.rotate+"deg)",p.style.oTransform="scale(0.9) rotate("+p.rotate+"deg)",p.style.transform="scale(0.9) rotate("+p.rotate+"deg)",u.innerHTML=l[Math.floor(p.rotate/360*l.length)],d<=0&&p.rotate>=s&&(clearInterval(n),e())},0):setInterval(function(){p.rotate-=c,p.rotate<=0&&(p.rotate+=360,d--,c/=2),p.style.webkitTransform="scale(0.9) rotate("+p.rotate+"deg)",p.style.msTransform="scale(0.9) rotate("+p.rotate+"deg)",p.style.oTransform="scale(0.9) rotate("+p.rotate+"deg)",p.style.transform="scale(0.9) rotate("+p.rotate+"deg)",u.innerHTML=l[Math.floor(p.rotate/360*l.length)],d<=0&&p.rotate<=s&&(clearInterval(n),e())},0)}).then(function(){m.classList.remove("hidden"),m.focus()}),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}),L.appendChild(I);var E=document.createElement("button");E.innerHTML=I18n("Quit"),E.addEventListener("click",function(e){n.setup(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),L.appendChild(E),d.section.appendChild(L),I.click()},writable:!1,enumerable:!0,configurable:!1}}),e}(),I18n=function(){function e(e){return a.call(t,e)?t[e]:e}var t={},a=Object.prototype.hasOwnProperty;try{var n,r,i=navigator.languages||[navigator.language];r=new XMLHttpRequest;var o=0,s=i.length;for(o;n=i[o],o<s;o++)try{if(r.open("GET",location.pathname.replace(/\/$/,"")+"/i18n/"+n+".json",!1),r.send(),200==r.status){t=JSON.parse(r.responseText||r.response);break}}catch(e){console.warn("aborted:",e)}}catch(e){console.warn("aborted:",e)}return e}();</script>
<app-view class="app-view" id="app-view-0"></app-view>
<script type="text/javascript">new Game("app-view-0").setup();</script>
